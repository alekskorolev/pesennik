<%layout('layout')%>
<div class="page-header">
  <h3><%=sing.name%> <small><%=sing.author%></small></h3>
  Владелец: <b><%=sing.user%></b>
  <% if (sing.createdAt) { %>
  	<br>Добавлена: <%=sing.createdAt.format('dd mmm yyyy, HH:mm')%>
  <% } %>
  <% if (sing.copylink) { %>
  	<br>Оригинал: <a href='<%=sing.copylink%>'><%=sing.copylink%></a>
  <% } %>
  <br>
  <% if (sing.user_id == user.id) { %>
  	<a href='/sing/edit/<%=sing._id%>'>Редактировать</a>
  	<a href='/sing/delete/<%=sing._id%>'>Удалить</a>
  <% } else { %>
    <a href='/sing/copy/<%=sing._id%>'>Скопировать эту песню себе</a>
  <% } %>
  <div>
    <span>Автопрокрутка: </span>
    <a class="js-autoroll-faster" href="#">| + |</a>&nbsp;&nbsp;&nbsp;
    <a class="js-autoroll-slower" href="#">| - |</a>
    <script type="text/javascript">
      $(function() {
        var $fasterBtn = $('.js-autoroll-faster'),
            $slowerBtn = $('.js-autoroll-slower'),
            rollVelocity = 0, lastRollVelocity = 0;
        
        rollVelocity = 0;
        setInterval(function() {
          $('html, body').stop();
          if (rollVelocity > 0) {
             $('html, body').animate({
              scrollTop: $(document).scrollTop() + rollVelocity * 3
            }, 1050, 'linear');
          }
        }, 1000);
        $('body').on('click', function() {
          $('html, body').stop();
          rollVelocity = 0;
        });
        $fasterBtn.on('click', function(event) {
          if (rollVelocity < 10) ++rollVelocity;
          event.stopPropagation();
          return false;
        });
        $slowerBtn.on('click', function(event) {
          if (rollVelocity > 0) --rollVelocity;
          event.stopPropagation();
          return false;
        });
      });
    </script>
  </div>
  <% if (sing.user_id == user.id) { %>
  	<br><BR>
  	Статус песни:
  	<% if (!sing.status) { %><span class='label label-default'><b>Не определен</b></span> \ <% } %>
  	<% if (sing.status=='no') { %> <b>Не выучена</b><% } else { %><a href='/sing/<%=sing._id%>/learn/no'>Не выучена</a><% } %> \ 
  	<% if (sing.status=='in') { %> <b>В процессе изучения</b><% } else { %><a href='/sing/<%=sing._id%>/learn/in'>В процессе изучения</a><% } %> \
  	<% if (sing.status=='yes') { %> <b>Выучена</b><% } else { %><a href='/sing/<%=sing._id%>/learn/yes'>Выучена</a><% } %>
  <% } %>
</div>

<div class='panel-body'>
	<pre>
<%-sing.text%>
	</pre>	
</div>

<div class='panel panel-default'>
	<div class='panel-heading'>
		Комментарии
	</div>
	<div class='panel-body'>
		<% if (comments.length==0) { %>
			<center><h3>Без комментариев</h3></center><br>
		<% } %>
		<%-partial('partials/comment', comments)%>

		<form role='form' method='POST' action="/sing/addcomment/<%=sing._id%>">
			<div class='form-group'>
				<label for='comment'>Добавить комментарий</label>
				<textarea name='text' id='comment' class='form-control'></textarea>
			</div>
			<button type='submit' class='btn btn-success'>Добавить</button>
		</form>
	</div>
</div>